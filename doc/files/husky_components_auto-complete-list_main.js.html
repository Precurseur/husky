<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>husky_components/auto-complete-list/main.js - husky</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="husky"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AutoCompleteList.html">AutoCompleteList</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/husky_components_auto-complete-list.html">husky/components/auto-complete-list</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: husky_components/auto-complete-list/main.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * This file is part of Husky frontend development framework.
 *
 * (c) MASSIVE ART WebServices GmbH
 *
 * This source file is subject to the MIT license that is bundled
 * with this source code in the file LICENSE.
 *
 * @module husky/components/auto-complete-list
 */

/**
 * @class AutoCompleteList
 * @constructor
 *
 * @param {Object} [options] Configuration object
 * @param {String} [options.url] url to load data
 **/
define([], function() {

        &#x27;use strict&#x27;;


        var defaults = {
                url: &#x27;&#x27;,                    // url to load data
                valueName: &#x27;name&#x27;,          // propertyName for value
                minLength: 3,               // min length for request
                keyControl: true,           // control with up/down key
                value: null,                // value to display at start
                excludeItems: [],           // items to filter
                instanceName: &#x27;undefined&#x27;   // name of the component instance
            },
            successClass = &#x27;husky-auto-complete-success&#x27;,
            failClass = &#x27;husky-auto-complete-error&#x27;,
            loadingClass = &#x27;husky-auto-complete-loading&#x27;,
            eventNamespace = &#x27;husky.auto-complete-list&#x27;,
            EVENT = { };

        /**
         * @event husky.auto-complete-list.rendered
         * @description fires when an animation begins.
         * @param {String} name Name of the ...
         */
        EVENT.renderd = eventNamespace + &#x27;rendered&#x27;;

        /**
         * @event husky.auto-complete-list.rendered
         * @description fires when an animation begins.
         * @param {String} name Name of the ...
         */
        EVENT.loaded = eventNamespace + &#x27;loaded&#x27;;

        return {
            data: [],

            getEvent: function(append) {
                return &#x27;husky.auto-complete-list.&#x27; + append;
            },

            /**
             * get url for pattern
             * @method getUrl
             * @param pattern
             * @returns {string}
             */
            getUrl: function(pattern) {
                var delimiter = &#x27;?&#x27;;
                if (this.options.url.indexOf(&#x27;?&#x27;) !== -1) {
                    delimiter = &#x27;&amp;&#x27;;
                }

                return this.options.url + delimiter + &#x27;search=&#x27; + pattern;
            },

            getValueID: function() {
                if (!!this.options.value) {
                    return this.options.value.id;
                } else {
                    return null;
                }
            },

            getValueName: function() {
                if (!!this.options.value) {
                    return this.options.value[this.options.valueName];
                } else {
                    return &#x27;&#x27;;
                }
            },

            initialize: function() {
                this.sandbox.logger.log(&#x27;initialize&#x27;, this);
                this.sandbox.logger.log(arguments);

                // extend default options
                this.options = this.sandbox.util.extend({}, defaults, this.options);

                this.render();
            },

            render: function() {
                this.$el.addClass(&#x27;dropdown husky-auto-complete&#x27;);
                // init form-element and dropdown menu
                this.$valueField = $(&#x27;&lt;input id=&quot;&#x27; + this.options.instanceName + &#x27;&quot; type=&quot;text&quot; autofill=&quot;false&quot; class=&quot;name-value form-element husky-validate&quot; data-id=&quot;&#x27; + this.getValueID() + &#x27;&quot; value=&quot;&#x27; + this.getValueName() + &#x27;&quot;/&gt;&#x27;);
                this.$dropDown = $(&#x27;&lt;div class=&quot;dropdown-menu&quot; /&gt;&#x27;);
                this.$dropDownList = $(&#x27;&lt;ul/&gt;&#x27;);
                this.$el.append(this.$valueField);
                this.$el.append(this.$dropDown);
                this.$dropDown.append(this.$dropDownList);
                this.hideDropDown();

                // bind dom elements
                this.bindDOMEvents();

                if (!!this.options.value) {
                    this.successState();
                }
            },

            // bind dom elements
            bindDOMEvents: function() {
                // turn off all events
                this.$el.off();

                // input value changed
                this.$valueField.on(&#x27;input&#x27;, this.inputChanged.bind(this));

                // mouse control
                this.$dropDownList.on(&#x27;click&#x27;, &#x27;li&#x27;, function(event) {
                    var $element = $(event.currentTarget),
                        id = $element.data(&#x27;id&#x27;),
                        item = {id: id};

                    item[this.options.valueName] = $element.text();
                    this.selectItem(item);
                }.bind(this));

                // focus in
                this.$valueField.on(&#x27;focusin&#x27;, function() {
                    this.$valueField.trigger(&#x27;input&#x27;);
                }.bind(this));

                // focus out
                this.$valueField.on(&#x27;focusout&#x27;, function() {
                    // FIXME may there is a better solution ???
                    setTimeout(function() {
                        this.hideDropDown();
                    }.bind(this), 250);
                }.bind(this));

                // key control
                if (this.options.keyControl) {
                    this.$valueField.on(&#x27;keydown&#x27;, function(event) {
                        // key 40 = down, key 38 = up, key 13 = enter
                        if ([40, 38, 13].indexOf(event.which) === -1) {
                            return;
                        }

                        event.preventDefault();
                        if (this.$dropDown.is(&#x27;:visible&#x27;)) {

                            if (event.which === 40) {
                                this.pressKeyDown();
                            }
                            else if (event.which === 38) {
                                this.pressKeyUp();
                            }
                            else if (event.which === 13) {
                                this.pressKeyEnter();
                            }

                        } else {
                            // If dropdown not visible =&gt; search for given pattern
                            this.noState();
                            this.loadData(this.$valueField.val());
                        }
                    }.bind(this));

                    // remove hover class by mouseover
                    this.$dropDownList.on(&#x27;mouseover&#x27;, &#x27;li&#x27;, function() {
                        this.$dropDownList.children().removeClass(&#x27;hover&#x27;);
                    }.bind(this));
                }
            },

            // value of input changed
            inputChanged: function() {
                this.sandbox.logger.log(&#x27;inputChanged&#x27;);

                // value is not success
                this.noState();

                var val = this.$valueField.val();
                if (val.length &gt;= this.options.minLength) {
                    this.loadData(val);
                }
            },

            // load data from server
            loadData: function(pattern) {
                var url = this.getUrl(pattern);
                this.sandbox.logger.log(&#x27;load: &#x27; + url);
                this.loadingState();

                $.ajax({
                    url: url,
                    success: function(response) {
                        this.sandbox.logger.log(&#x27;load&#x27;, &#x27;success&#x27;);

                        this.noState();

                        // if only one result this is it, if no result hideDropDown, else generateDropDown
                        this.updateData(response.items);
                        if (this.data.length &gt; 1) {
                            this.generateDropDown(this.data);
                        } else if (this.data.length === 1) {
                            this.selectItem(this.data[0]);
                        } else {
                            this.failState();
                            this.hideDropDown();
                        }
                    }.bind(this),
                    error: function() {
                        this.sandbox.logger.log(&#x27;load&#x27;, &#x27;error&#x27;);

                        this.failState();
                        this.hideDropDown();
                    }.bind(this)
                });

                this.sandbox.emit(this.getEvent(&#x27;load-data&#x27;));
            },

            // update global data array
            updateData: function(newData) {
                this.data = [];
                if (!!newData &amp;&amp; $.isArray(newData)) {
                    newData.forEach(function(item) {
                        if (this.isVisible(item)) {
                            this.data.push(item);
                        }
                    }.bind(this));
                }
            },

            // generate dropDown with given items
            generateDropDown: function(items) {
                this.clearDropDown();
                items.forEach(function(item) {
                    if (this.isVisible(item)) {
                        this.$dropDownList.append(&#x27;&lt;li data-id=&quot;&#x27; + item.id + &#x27;&quot;&gt;&#x27; + item[this.options.valueName] + &#x27;&lt;/li&gt;&#x27;);
                    }
                }.bind(this));
                this.showDropDown();
            },

            // is item visible (filter)
            isVisible: function(item) {
                var result = true;
                this.options.excludeItems.forEach(function(testItem) {
                    if (parseInt(item.id, 10) === parseInt(testItem.id, 10)) {
                        result = false;
                    }
                }.bind(this));
                return result;
            },

            // clear childs of list
            clearDropDown: function() {
                // FIXME make it easier
                this.$dropDown.children(&#x27;ul&#x27;).children(&#x27;li&#x27;).remove();
            },

            // make dropDown visible
            showDropDown: function() {
                this.sandbox.logger.log(&#x27;show dropdown&#x27;);
                this.$dropDown.show();
            },

            // hide dropDown
            hideDropDown: function() {
                this.sandbox.logger.log(&#x27;hide dropdown&#x27;);
                this.clearDropDown();
                this.$dropDown.hide();
            },

            // set class success to container
            successState: function() {
                this.sandbox.logger.log(&#x27;set success&#x27;);
                this.clearDropDown();
                this.$el.parent().removeClass(failClass);
                this.$el.parent().removeClass(loadingClass);
                this.$el.parent().addClass(successClass);
            },

            // remove class success, fail and loading of container
            noState: function() {
                this.sandbox.logger.log(&#x27;remove success and fail&#x27;);
                this.$valueField.data(&#x27;&#x27;);
                this.$el.parent().removeClass(failClass);
                this.$el.parent().removeClass(loadingClass);
                this.$el.parent().removeClass(successClass);
            },

            // add class fail to container
            failState: function() {
                this.sandbox.logger.log(&#x27;set fail&#x27;);
                this.$el.parent().addClass(failClass);
                this.$el.parent().removeClass(loadingClass);
                this.$el.parent().removeClass(successClass);
            },

            // add class loading to container
            loadingState: function() {
                this.sandbox.logger.log(&#x27;set loading&#x27;);
                this.$el.parent().removeClass(failClass);
                this.$el.parent().addClass(loadingClass);
                this.$el.parent().removeClass(successClass);
            },

            // handle key down
            pressKeyDown: function() {
                this.sandbox.logger.log(&#x27;key down&#x27;);

                // get actual and next element
                var $actual = this.$dropDownList.children(&#x27;.hover&#x27;),
                    $next = $actual.next();

                // no element selected
                if ($next.length === 0) {
                    $next = this.$dropDownList.children().first();
                }

                $actual.removeClass(&#x27;hover&#x27;);
                $next.addClass(&#x27;hover&#x27;);
            },

            // handle key up
            pressKeyUp: function() {
                this.sandbox.logger.log(&#x27;key up&#x27;);

                // get actual and next element
                var $actual = this.$dropDownList.children(&#x27;.hover&#x27;),
                    $next = $actual.prev();
                // no element selected
                if ($next.length === 0) {
                    $next = this.$dropDownList.children().last();
                }

                $actual.removeClass(&#x27;hover&#x27;);
                $next.addClass(&#x27;hover&#x27;);
            },

            // handle key enter
            pressKeyEnter: function() {
                this.sandbox.logger.log(&#x27;key enter&#x27;);

                // if one element selected
                var $actual = this.$dropDownList.children(&#x27;.hover&#x27;),
                    item, value, childs, that;
                if ($actual.length === 1) {
                    item = {id: $actual.data(&#x27;id&#x27;)};
                    item[this.options.valueName] = $actual.text();
                    this.selectItem(item);
                } else {
                    // if it is one of the list
                    value = this.$valueField.val();
                    childs = this.$dropDownList.children();
                    that = this;

                    $(childs).each(function() {
                        if ($(this).text() === value) {
                            // found an item select it
                            var item = {id: $(this).data(&#x27;id&#x27;)};
                            item[that.options.valueName] = $(this).text();
                            that.selectItem(item);
                            return false;
                        }
                    });
                }
            },

            // select an item
            selectItem: function(item) {
                this.sandbox.logger.log(&#x27;select item: &#x27; + item.id);
                // set id to data-id
                this.$valueField.data(&#x27;id&#x27;, item.id);
                // set value to value
                this.$valueField.val(item[this.options.valueName]);

                this.hideDropDown();
                this.successState();
            }
        };
    }
);

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
