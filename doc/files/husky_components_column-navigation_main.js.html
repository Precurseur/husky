<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>husky_components/column-navigation/main.js - husky</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="husky"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.9.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AutoComplete.html">AutoComplete</a></li>
            
                <li><a href="../classes/AutoCompleteList.html">AutoCompleteList</a></li>
            
                <li><a href="../classes/CKEditor.html">CKEditor</a></li>
            
                <li><a href="../classes/Column-Options.html">Column-Options</a></li>
            
                <li><a href="../classes/ColumnNavigation.html">ColumnNavigation</a></li>
            
                <li><a href="../classes/DataGrid.html">DataGrid</a></li>
            
                <li><a href="../classes/Dependant Select.html">Dependant Select</a></li>
            
                <li><a href="../classes/DropdownPagination (Datagrid Decorator).html">DropdownPagination (Datagrid Decorator)</a></li>
            
                <li><a href="../classes/Dropzone.html">Dropzone</a></li>
            
                <li><a href="../classes/GroupView (Datagrid Decorator).html">GroupView (Datagrid Decorator)</a></li>
            
                <li><a href="../classes/Input.html">Input</a></li>
            
                <li><a href="../classes/Label.html">Label</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Matcher.html">Matcher</a></li>
            
                <li><a href="../classes/Overlay.html">Overlay</a></li>
            
                <li><a href="../classes/Process.html">Process</a></li>
            
                <li><a href="../classes/Search.html">Search</a></li>
            
                <li><a href="../classes/Select.html">Select</a></li>
            
                <li><a href="../classes/TableView (Datagrid Decorator).html">TableView (Datagrid Decorator)</a></li>
            
                <li><a href="../classes/Tabs.html">Tabs</a></li>
            
                <li><a href="../classes/ThumbnailView (Datagrid Decorator).html">ThumbnailView (Datagrid Decorator)</a></li>
            
                <li><a href="../classes/Toggler.html">Toggler</a></li>
            
                <li><a href="../classes/Toolbar.html">Toolbar</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/husky_components_auto-complete.html">husky/components/auto-complete</a></li>
            
                <li><a href="../modules/husky_components_auto-complete-list.html">husky/components/auto-complete-list</a></li>
            
                <li><a href="../modules/husky_components_column-navigation.html">husky/components/column-navigation</a></li>
            
                <li><a href="../modules/husky_components_column-options.html">husky/components/column-options</a></li>
            
                <li><a href="../modules/husky_components_dropzone.html">husky/components/dropzone</a></li>
            
                <li><a href="../modules/husky_components_input.html">husky/components/input</a></li>
            
                <li><a href="../modules/husky_components_label.html">husky/components/label</a></li>
            
                <li><a href="../modules/husky_components_listbox.html">husky/components/listbox</a></li>
            
                <li><a href="../modules/husky_components_matcher.html">husky/components/matcher</a></li>
            
                <li><a href="../modules/husky_components_overlay.html">husky/components/overlay</a></li>
            
                <li><a href="../modules/husky_components_process.html">husky/components/process</a></li>
            
                <li><a href="../modules/husky_components_toolbar.html">husky/components/toolbar</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: husky_components/column-navigation/main.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * This file is part of Husky frontend development framework.
 *
 * (c) MASSIVE ART WebServices GmbH
 *
 * This source file is subject to the MIT license that is bundled
 * with this source code in the file LICENSE.
 *
 * @module husky/components/column-navigation
 */


/**
 * @class ColumnNavigation
 * @constructor
 *
 * @params {Object} [options] Configuration object
 * @params {String} [options.url] url to load data
 * @params {String} [options.selected] id of selected element - needed to restore state
 * @params {String} [options.actionIcon] icon class of action button
 * @params {Array}  [options.data] array of data displayed in the settings dropdown
 * @params {String} [options.instanceName] name of current instance
 * @params {String} [options.hasSubName] name of hasSub-key
 * @params {String} [options.idName] name of id-key
 * @params {String} [options.pathName] name of path-key
 * @params {String} [options.linkedName] name of linked-key
 * @params {String} [options.publishedName] name of published-key
 * @params {String} [options.titleName] name of title-key
 * @params {String} [options.noPageDescription] translation key for the &quot;No-Page&quot;-description
 * @params {String} [options.resultKey] The name of the array in the responded _embedded
 * @params {Boolean} [options.responsive] If true the resize listener gets initialized. Otherwise the column navigation just takes up 100 % of the height and width
 * @params {Boolean} [options.showOptions] hide or shows the options
 * @params {Boolean} [options.showActionIcon] if true the action icon is shown, not shown otherwise
 * @params {Boolean} [options.showStatus] hide or display status of elements
 * @params {String} [options.skin] css class which gets added to the components element. Available: &#x27;&#x27;, &#x27;fixed-height-small&#x27;
 * @params {Boolean} [options.markable] If true a node gets marked with a css class on click on the blue button
 * @params {Array} [options.premarkedIds] an array of uuids of nodes which should be marked from the beginning on
 * @params {Boolean} [options.orderable] if true component-items can be ordered
 * @params {Boolean} [options.tooltipTranslations] translation-keys for the tooltips
 * @params {Boolean} [options.tooltipTranslations.ghost] translation-keys for ghost
 * @params {Boolean} [options.tooltipTranslations.shadow] translation-keys for shadow
 * @params {Boolean} [options.tooltipTranslations.unpublished] translation-keys for unpublished
 * @params {Boolean} [options.tooltipTranslations.internalLink] translation-keys for internal-link
 * @params {Boolean} [options.tooltipTranslations.externalLink] translation-keys for external-link
 */
define([], function () {

    &#x27;use strict&#x27;;

    var defaults = {
            url: null,
            selected: null,
            data: null,
            instanceName: &#x27;&#x27;,
            hasSubName: &#x27;hasSub&#x27;,
            actionIcon: &#x27;fa-pencil&#x27;,
            idName: &#x27;id&#x27;,
            pathName: &#x27;path&#x27;,
            linkedName: &#x27;linked&#x27;,
            publishedName: &#x27;publishedState&#x27;,
            titleName: &#x27;title&#x27;,
            typeName: &#x27;type&#x27;,
            noPageDescription: &#x27;public.no-pages&#x27;,
            skin: &#x27;&#x27;,
            resultKey: &#x27;nodes&#x27;,
            responsive: true,
            showOptions: true,
            showStatus: true,
            premarkedIds: [],
            markable: false,
            orderable: true,
            showActionIcon: true,
            orderConfirmTitle: &#x27;Be careful&#x27;,
            orderConfirmMessage: &#x27;Are you sure you want to move this item?&#x27;,
            tooltipTranslations: {
                ghost: &#x27;column-navigation.ghost&#x27;,
                shadow: &#x27;column-navigation.shadow&#x27;,
                unpublished: &#x27;public.unpublished&#x27;,
                internalLink: &#x27;public.internal-link&#x27;,
                externalLink: &#x27;public.external-link&#x27;
            }
        },

        constants = {
            responsiveHeightRation: 7 / 10,
            columnWidth: 250,
            minVisibleRatio: 1 / 2,
            markedClass: &#x27;marked&#x27;,
            displayedcolumns: 2, // number of displayed columns with content
            wrapperClass: &#x27;column-navigation-wrapper&#x27;,
            columnClass: &#x27;column&#x27;,
            optionsClass: &#x27;options&#x27;,
            componentClass: &#x27;husky-column-navigation&#x27;,
            nodeLoaderClass: &#x27;husky-column-navigation-loader&#x27;,
            bigLoaderClass: &#x27;column-navigation-loader&#x27;,
            columnItemClass: &#x27;column-item&#x27;,
            iconsLeftClass: &#x27;icons-left&#x27;,
            iconsRightClass: &#x27;icons-right&#x27;,
            itemTextClass: &#x27;item-text&#x27;,
            orderInputClass: &#x27;orderer&#x27;,
            orderErrorClass: &#x27;husky-validate-error&#x27;,
            highlightClass: &#x27;highlight-animation&#x27;,
            orderModeClass: &#x27;order-mode&#x27;
        },

        templates = {
            wrapper: [&#x27;&lt;div class=&quot;&#x27; + constants.wrapperClass + &#x27;&quot;&gt;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),
            container: [&#x27;&lt;div class=&quot;column-navigation&quot;&gt;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

            column: [&#x27;&lt;div data-column=&quot;&lt;%= columnNumber %&gt;&quot; class=&quot;&#x27; + constants.columnClass + &#x27;&quot; id=&quot;&lt;%= id %&gt;&quot;&gt;&#x27;,
                     &#x27;    &lt;ul&gt;&lt;/ul&gt;&#x27;,
                    &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

            noPage: [&#x27;&lt;div class=&quot;no-page&quot;&gt;&#x27;,
                     &#x27;    &lt;span class=&quot;fa-coffee icon&quot;&gt;&lt;/span&gt;&#x27;,
                     &#x27;    &lt;div class=&quot;text&quot;&gt;&lt;%= description %&gt;&lt;/div&gt;&#x27;,
                     &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

            optionsContainer: [&#x27;&lt;div class=&quot;&#x27; + constants.optionsClass + &#x27; grid-row&quot;&gt;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

            optionsAdd: [&#x27;&lt;div class=&quot;align-center add pointer&quot;&gt;&#x27;,
                            &#x27;&lt;span class=&quot;fa-plus-circle&quot;&gt;&lt;/span&gt;&#x27;,
                         &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

            optionsSettings: [&#x27;&lt;div class=&quot;align-center settings pointer drop-down-trigger&quot;&gt;&#x27;,
                              &#x27;   &lt;span class=&quot;fa-gear inline-block&quot;&gt;&lt;/span&gt;&lt;span class=&quot;dropdown-toggle inline-block&quot;&gt;&lt;/span&gt;&#x27;,
                              &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

            optionsOk: [&#x27;&lt;div class=&quot;align-center ok pointer&quot;&gt;&#x27;,
                        &#x27;   &lt;span class=&quot;fa-check&quot;&gt;&lt;/span&gt;&#x27;,
                        &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

            item: [&#x27;&lt;li data-id=&quot;&lt;%= id %&gt;&quot; class=&quot;&#x27; + constants.columnItemClass + &#x27;&quot;&gt;&#x27;,
                   &#x27;    &lt;span class=&quot;&#x27; + constants.iconsLeftClass + &#x27;&quot;&gt;&lt;/span&gt;&#x27;,
                   &#x27;    &lt;span title=&quot;&lt;%= title %&gt;&quot; class=&quot;&#x27; + constants.itemTextClass + &#x27;&quot;&gt;&lt;%= title%&gt;&lt;/span&gt;&#x27;,
                   &#x27;    &lt;span class=&quot;&#x27; + constants.iconsRightClass + &#x27;&quot;&gt;&lt;/span&gt;&#x27;,
                   &#x27;&lt;/li&gt;&#x27;].join(&#x27;&#x27;),

            orderInput: [&#x27;&lt;span class=&quot;&#x27; + constants.orderInputClass + &#x27;&quot;&gt;&#x27;,
                        &#x27;   &lt;input type=&quot;text&quot; class=&quot;form-element husky-validate&quot; value=&quot;&lt;%= value %&gt;&quot; /&gt;&#x27;,
                        &#x27;&lt;/span&gt;&#x27;].join(&#x27;&#x27;)
        },

        /**
         * namespace for events
         * @type {string}
         */
        eventNamespace = &#x27;husky.column-navigation.&#x27;,

        /**
         * @event husky.column-navigation.initialized
         * @description thrown after initialization has finished
         */
        INITIALIZED = function () {
            return createEventName.call(this, &#x27;initialized&#x27;);
        },

        /**
         * @event husky.column-navigation.loaded
         * @description the component has loaded everything successfully and will be rendered
         */
        LOADED = function () {
            return createEventName.call(this, &#x27;loaded&#x27;);
        },

        /**
         * @event husky.column-navigation.selected
         * @description an navigation element has been selected
         * @param {Object} selected object
         */
        SELECTED = function () {
            return createEventName.call(this, &#x27;selected&#x27;);
        },

        /**
         * @event husky.column-navigation.settings
         * @description an navigation element has been selected and a item from selected dropdown clicked
         * @param {Object} selected column navigation object
         * @param {Object} clicked dropdown item
         */
        SETTINGS = function () {
            return createEventName.call(this, &#x27;settings&#x27;);
        },

        /**
         * @event husky.column-navigation.add
         * @description the add button has been clicked
         * @param {Object} parent object from active column level
         */
        ADD = function () {
            return createEventName.call(this, &#x27;add&#x27;);
        },

        /**
         * @event husky.column-navigation.action
         * @description emitted if the action-icon of an item gets clicked
         * @param {Object} clicked item
         */
        ACTION = function () {
            return createEventName.call(this, &#x27;action&#x27;);
        },

        /**
         * @event husky.column-navigation.ordered
         * @description emited when the position of an item gets changed
         * @param {String} uuid of the reposition item
         * @param {Number} the new position of the item
         */
        ORDERED = function () {
            return createEventName.call(this, &#x27;ordered&#x27;);
        },

        /**
         * @event husky.column-navigation.order
         * @description listens on and sets the column containing an item with a given id in order-mode
         * @param {String} uuid of the item
         */
        ORDER = function () {
            return createEventName.call(this, &#x27;order&#x27;);
        },

        /**
         * @event husky.column-navigation.order-start
         * @description emited if a column is set in order-mode
         */
        ORDER_START = function () {
            return createEventName.call(this, &#x27;order-start&#x27;);
        },

        /**
         * @event husky.column-navigation.order-start
         * @description emited if a column is set in order-mode
         */
        ORDER_END = function () {
            return createEventName.call(this, &#x27;order-end&#x27;);
        },

        /**
         * @event husky.column-navigation.unmark
         * @description listens on and unmarks a node with a given id
         * @param {Number|String} the id of the node to unmark
         */
        UNMARK = function () {
            return createEventName.call(this, &#x27;unmark&#x27;);
        },

        /**
         * @event husky.column-navigation.highlight
         * @description listens on and highlights an item with a given uuid
         * @param {Number|String} the id of the item to highlight
         */
        HIGHLIGHT = function () {
            return createEventName.call(this, &#x27;highlight&#x27;);
        },

        /**
         * @event husky.column-navigation.get-breadcrumb
         * @description the breadcrumb will be returned
         * @param {Function} callback function which will process the breadcrumb objects
         */
        BREADCRUMB = function () {
            return createEventName.call(this, &#x27;get-breadcrumb&#x27;);
        },

        /**
         * @event husky.column-navigation.resize
         * @description the element will be resized
         * @param {Function} callback function which will process the breadcrumb objects
         */
        RESIZE = function () {
            return createEventName.call(this, &#x27;resize&#x27;);
        },

        /** returns normalized event names */
        createEventName = function (postFix) {
            return eventNamespace + (this.options.instanceName ? this.options.instanceName + &#x27;.&#x27; : &#x27;&#x27;) + postFix;
        };

    return {

        initialize: function () {
            this.options = this.sandbox.util.extend(true, {}, defaults, this.options);

            this.setProperties();
            this.render();
            this.startBigLoader();
            this.load(this.options.url, 0);
            this.bindDOMEvents();
            this.bindCustomEvents();

            this.sandbox.emit(INITIALIZED.call(this));
        },

        /**
         * Initializes the class properties with their default-values
         */
        setProperties: function() {
            this.$selectedElement = null;
            this.filledColumns = 0;
            this.columnLoadStarted = false;
            this.isOrdering = false; // flag (only one item at a time can be ordered)
            this.inOrderMode = false; // flag (only one column at a time can be in order-mode)
            this.optionsLocked = false;
            this.dom = {
                $wrapper: null,
                $container: null,
                $add: null,
                $settings: null,
                $bigLoader: null,
                $loader: null,
                $ok: null,
                $lastClicked: null
            };

            this.columns = [];
            this.selected = [];
            // array with all marked ids
            this.marked = this.options.premarkedIds || [];
        },

        /**
         * Renders basic structure (wrapper) of column navigation
         */
        render: function() {
            this.renderWrapper();
            if (!!this.options.showOptions) { // Options-toolbar with &quot;add&quot; and &quot;settings&quot;
                this.renderOptions();
            }
            if (!!this.options.data) {
                this.initSettingsDropdown();
            }
            if (this.options.responsive === true) {
                this.setContainerHeight();
            }
        },

        /**
         * Returns the index of a column which contains an item with a given id
         * @param item - the id of the item
         * @returns {number} the index of the column if found, a value below 0 otherwise
         */
        getColumnForItem: function (item) {
            for (var i = -1, length = this.columns.length; ++i &lt; length;) {
                if (!!this.columns[i] &amp;&amp; !!this.columns[i][item]) {
                    return i;
                }
            }
            return -1;
        },

        /**
         * Renders the options-buttons. &quot;Add&quot; and &quot;Settings&quot;
         */
        renderOptions: function() {
            this.$optionsContainer = this.sandbox.dom.createElement(templates.optionsContainer);
            this.dom.$add = this.sandbox.dom.createElement(templates.optionsAdd);
            this.dom.$settings = this.sandbox.dom.createElement(templates.optionsSettings);
            this.dom.$ok = this.sandbox.dom.createElement(templates.optionsOk);
            this.sandbox.dom.hide(this.dom.$ok);
            this.sandbox.dom.append(this.$optionsContainer, this.dom.$add);
            this.sandbox.dom.append(this.$optionsContainer, this.dom.$settings);
            this.sandbox.dom.append(this.$optionsContainer, this.dom.$ok);
            this.hideOptions();
            this.sandbox.dom.append(this.dom.$wrapper, this.$optionsContainer);
        },

        /**
         * Renders the component wrapper and an additional container
         */
        renderWrapper: function() {
            this.sandbox.dom.addClass(this.$el, constants.componentClass);
            if (!!this.options.skin) {
                this.sandbox.dom.addClass(this.$el, this.options.skin);
            }

            this.dom.$wrapper = this.sandbox.dom.createElement(templates.wrapper);
            this.sandbox.dom.append(this.$el, this.dom.$wrapper);

            // navigation container
            this.dom.$container = this.sandbox.dom.createElement(templates.container);
            this.sandbox.dom.append(this.dom.$wrapper, this.dom.$container);
        },

        /**
         * Starts the big loader, before loading content during the initialization
         */
        startBigLoader: function () {
            if (this.dom.$bigLoader === null) {
                this.dom.$bigLoader = this.sandbox.dom.createElement(&#x27;&lt;div class=&quot;&#x27;+ constants.bigLoaderClass +&#x27;&quot;/&gt;&#x27;);
                this.sandbox.dom.hide(this.dom.$bigLoader);
                this.sandbox.dom.html(this.dom.$container, this.dom.$bigLoader);

                this.sandbox.start([
                    {
                        name: &#x27;loader@husky&#x27;,
                        options: {
                            el: this.dom.$bigLoader,
                            size: &#x27;100px&#x27;,
                            color: &#x27;#e4e4e4&#x27;
                        }
                    }
                ]);
            }
            this.sandbox.dom.show(this.dom.$bigLoader);
        },

        /**
         * Detatches the big loader from the column-navigation
         */
        removeBigLoader: function () {
            this.sandbox.dom.hide(this.dom.$bigLoader);
        },

        /**
         * Sets the height of the container
         */
        setContainerHeight: function () {
            var height = this.sandbox.dom.height(this.sandbox.dom.$window),
                top = this.sandbox.dom.offset(this.$el).top;
            this.sandbox.dom.height(this.dom.$container, (height - top) * constants.responsiveHeightRation);
        },

        /**
         * Instantiats the dropdown component
         */
        initSettingsDropdown: function () {

            // TODO show dropdown only if item is selected and enable/disable certain elements of the dropdown depending on the selected element

            this.sandbox.start([
                {
                    name: &#x27;dropdown@husky&#x27;,
                    options: {
                        el: this.dom.$settings,
                        setParentDropDown: true,
                        instanceName: this.options.instanceName + &#x27;.settings.dropdown&#x27;,
                        alignment: &#x27;left&#x27;,
                        data: this.options.data
                    }
                }
            ]);
        },

        /**
         * Loads data from a specific url and triggers the parsing
         * @param {String} url
         * @param {Number} columnNumber
         */
        load: function (url, columnNumber) {
            if (!!url) {
                this.columnLoadStarted = true;
                this.sandbox.util.load(url)
                    .then(function (response) {
                        this.removeBigLoader();
                        this.columnLoadStarted = false;
                        this.parseData(response, columnNumber);
                        this.scrollIfNeeded(this.filledColumns + 1);
                        this.setOverflowClass();
                        this.showOptionsAtLast();
                        this.sandbox.emit(LOADED.call(this));
                    }.bind(this))
                    .fail(function (error) {
                        this.columnLoadStarted = false;
                        this.sandbox.logger.error(&quot;An error occured while fetching data from: &quot;, error);
                    }.bind(this));

            } else {
                this.sandbox.logger.log(&quot;husky.column.navigation -  url not set, aborted loading of data&quot;);
            }
        },

        /**
         * Removes removes data and removes dom elements
         * @param {Number} newColumn
         */
        removeColumns: function (newColumn) {
            var length = this.filledColumns,
                i;

            for (i = length; i &gt;= newColumn; i--) {
                delete this.columns[i];
                this.sandbox.dom.remove(&#x27;#column&#x27; + this.options.instanceName + &#x27;-&#x27; + i);
                this.filledColumns--;
            }
        },

        /**
         * Parses the received data and renders columns
         * @param {String} data
         * @param {Number} columnNumber
         */
        parseData: function (data, columnNumber) {
            // if there is nothing loaded yet, create a &quot;root&quot;-column
            if (columnNumber === 0) {
                this.columns[0] = {};
                this.columns[0][data[this.options.idName]] = data;
            }
            var newColNumber = columnNumber + 1;

            this.renderColumn(newColNumber, data);
            this.removeLoadingIconForSelected();
        },

        /**
         * Renderes a column
         * @param number - the number of the new column
         * @param data - the data for the column
         */
        renderColumn: function(number,  data) {
            var $column = this.sandbox.dom.createElement(this.sandbox.util.template(templates.column)({
                columnNumber: number,
                id: &#x27;column&#x27; + this.options.instanceName + &#x27;-&#x27; + number
            }));
            this.sandbox.dom.append(this.dom.$container, $column);
            this.filledColumns = number;
            this.renderItems($column, number, data);
        },

        /**
         * Renderes the items for a column
         * @param $column - the dom-object of the column
         * @param number - the number of the column to add the items to
         * @param data - the columns data object
         */
        renderItems: function($column, number, data) {
            var $list = this.sandbox.dom.find(&#x27;ul&#x27;, $column), nodeWithSubNodes, lastSelected;
            this.sandbox.util.each(data._embedded[this.options.resultKey], function (index, itemData) {
                itemData.order = (index + 1);
                var $item = this.renderItem(itemData);
                itemData.$el = $item;
                this.storeDataItem(number, itemData);
                this.sandbox.dom.append($list, $item);
                this.setItemsTextWidth($item);

                // if there are sub-nodes for this node loaded (need to be rendered later, so we save a reference)
                if (!!itemData[this.options.hasSubName] &amp;&amp; !!itemData._embedded[this.options.resultKey] &amp;&amp; itemData._embedded[this.options.resultKey].length &gt; 0) {
                    nodeWithSubNodes = itemData;
                    this.setElementSelected($item);
                    this.selected[number] = itemData;
                }

                // if this node is the specified as selected in the options, we select it
                if (!!this.options.selected &amp;&amp; (this.options.selected === itemData[this.options.idName] || this.options.selected === itemData[this.options.pathName])) {
                    this.setElementSelected($item);
                    this.selected[number] = itemData;
                    lastSelected = itemData;
                }
            }.bind(this));

            // here we come back the the node with the sub-nodes and recursively parse the sub-nodes-column
            if (!!nodeWithSubNodes) {
                this.parseData(nodeWithSubNodes, number);
            // otherwise, if there are no sub-nodes and we have a selected node - we display the &quot;No-Pages&quot;-column
            } else if (!!lastSelected &amp;&amp; !lastSelected[this.options.hasSubName]) {
                this.insertAddColumn(lastSelected, number);
            }
        },

        /**
         * Takes the data object and returns a column-item
         * @param data - the item&#x27;s data
         * @returns the items dom-object
         */
        renderItem: function(data) {
            var $item = this.sandbox.dom.createElement(this.sandbox.util.template(templates.item)({
                title: data[this.options.titleName],
                id: data[this.options.idName]
            }));
            if (this.marked.indexOf(data[this.options.idName]) !== -1) { // if is marked
                this.sandbox.dom.addClass($item, constants.markedClass);
            }
            this.renderLeftInfo($item, data);
            this.renderItemText($item, data);
            this.renderRightInfo($item, data);
            return $item;
        },

        /**
         * Renders the left buttons and icons for an item
         * @param $item - dom object of the item
         * @param data - the item&#x27;s data
         */
        renderLeftInfo: function($item, data) {
            var $container = this.sandbox.dom.find(&#x27;.&#x27; + constants.iconsLeftClass, $item);
            this.sandbox.dom.append($container, &#x27;&lt;span class=&quot;fa-check pull-left marked-icon&quot;&gt;&lt;/span&gt;&#x27;);
            if (!!this.options.showStatus) {
                // link
                if (!!data[this.options.linkedName]) {
                    if (data[this.options.linkedName] === &#x27;internal&#x27;) {
                        this.sandbox.dom.append($container,
                            &#x27;&lt;span class=&quot;fa-internal-link col-icon&quot; title=&quot;&#x27;+ this.sandbox.translate(this.options.tooltipTranslations.internalLink) +&#x27;&quot;&gt;&lt;/span&gt;&#x27;);
                    } else if (data[this.options.linkedName] === &#x27;external&#x27;) {
                        this.sandbox.dom.append($container,
                            &#x27;&lt;span class=&quot;fa-external-link col-icon&quot;  title=&quot;&#x27;+ this.sandbox.translate(this.options.tooltipTranslations.externalLink) +&#x27;&quot;&gt;&lt;/span&gt;&#x27;);
                    }
                }
                // type (ghost, shadow)
                if (!!data[this.options.typeName]) {
                    if (data[this.options.typeName].name === &#x27;ghost&#x27;) {
                        this.sandbox.dom.append($container,
                                &#x27;&lt;span class=&quot;ghost col-icon&quot;  title=&quot;&#x27;+ this.sandbox.translate(this.options.tooltipTranslations.ghost) +&#x27;&quot;&gt;&#x27;+ data[this.options.typeName].value +&#x27;&lt;/span&gt;&#x27;);
                    } else if (data[this.options.typeName].name === &#x27;shadow&#x27;) {
                        this.sandbox.dom.append($container,
                            &#x27;&lt;span class=&quot;fa-shadow-node col-icon&quot;  title=&quot;&#x27;+ this.sandbox.translate(this.options.tooltipTranslations.shadow) +&#x27;&quot;&gt;&lt;/span&gt;&#x27;);
                    }
                }
                // unpublished
                if (!data[this.options.publishedName]) {
                    this.sandbox.dom.append($container,
                        &#x27;&lt;span class=&quot;not-published col-icon&quot;  title=&quot;&#x27;+ this.sandbox.translate(this.options.tooltipTranslations.unpublished) +&#x27;&quot;&gt;&amp;bull;&lt;/span&gt;&#x27;);
                }
            }
            if (!!this.options.orderable) {
                this.sandbox.dom.append($container, this.sandbox.util.template(templates.orderInput)({
                    value: data.order
                }));
            }
        },

        /**
         * Renderes the text element of a column-item
         * @param $item - dom object of the item
         * @param data - the data for the item
         */
        renderItemText: function($item, data) {
            var $container = this.sandbox.dom.find(&#x27;.&#x27; + constants.itemTextClass, $item);
            if (!!data[this.options.typeName] &amp;&amp; data[this.options.typeName].name === &#x27;ghost&#x27;) {
                this.sandbox.dom.addClass($container, &#x27;inactive&#x27;);
            }
        },

        /**
         * Renders the right buttons and icons for an item
         * @param $item - dom object of the item
         * @param data - the data for the item
         */
        renderRightInfo: function($item, data) {
            var $container = this.sandbox.dom.find(&#x27;.&#x27; + constants.iconsRightClass, $item);
            if (this.options.showActionIcon === true) {
                this.sandbox.dom.append($container, &#x27;&lt;span class=&quot;&#x27; + this.options.actionIcon + &#x27; action col-icon&quot;&gt;&lt;/span&gt;&#x27;);
            }
            if (!!data[this.options.hasSubName]) {
                this.sandbox.dom.append($container, &#x27;&lt;span class=&quot;fa-chevron-right arrow inactive col-icon&quot;&gt;&lt;/span&gt;&#x27;);
            }
        },

        /**
         * Sets the width of the text-container of an item
         * @param {Object} $item the dom-object of an item
         */
        setItemsTextWidth: function ($item) {
            var width, $itemText;

            $itemText = this.sandbox.dom.find(&#x27;.item-text&#x27;, $item);
            width = constants.columnWidth - this.sandbox.dom.outerWidth(this.sandbox.dom.find(&#x27;.icons-left&#x27;, $item));
            width -= parseInt(this.sandbox.dom.css($item, &#x27;padding-right&#x27;).replace(&#x27;px&#x27;, &#x27;&#x27;));
            width -= parseInt(this.sandbox.dom.css($item, &#x27;padding-left&#x27;).replace(&#x27;px&#x27;, &#x27;&#x27;));
            width -= this.sandbox.dom.outerWidth(this.sandbox.dom.find(&#x27;.icons-right&#x27;, $item));
            width -= 17; // FIXME: Better solution? (For potential scrollbar)
            this.sandbox.dom.width($itemText, width);
            this.cropItemsText($itemText);
        },

        /**
         * Sets the text width of all items in a column
         * @param column
         */
        setColumnTextWidth: function(column) {
            this.sandbox.util.each(this.columns[column], function (id, item) {
                this.setItemsTextWidth(item.$el);
            }.bind(this));
        },

        /**
         * Crops the item text of an item depending on its width
         * @param $itemText {Object}
         */
        cropItemsText: function ($itemText) {
            var title = this.sandbox.dom.attr($itemText, &#x27;title&#x27;),
                croppedTitle,
                maxLength = title.length,
                overflow;

            //set the item text to the original title
            this.sandbox.dom.html($itemText, title);
            this.sandbox.dom.css($itemText, &#x27;font-weight&#x27;, &#x27;bold&#x27;);

            overflow = (this.sandbox.dom.get($itemText, 0).scrollWidth &gt; this.sandbox.dom.width($itemText));

            while (overflow === true) {
                maxLength--;
                croppedTitle = this.sandbox.util.cropMiddle(title, maxLength);
                this.sandbox.dom.html($itemText, croppedTitle);
                overflow = (this.sandbox.dom.get($itemText, 0).scrollWidth &gt; this.sandbox.dom.width($itemText));
            }
            this.sandbox.dom.css($itemText, &#x27;font-weight&#x27;, &#x27;&#x27;);
        },

        /**
         * Sets/removes all needed classes to display a node as selected
         * @param $element
         */
        setElementSelected: function ($element) {
            this.sandbox.dom.addClass($element, &#x27;selected&#x27;);
            var $arrowElement = this.sandbox.dom.find(&#x27;.arrow&#x27;, $element);
            this.sandbox.dom.removeClass($arrowElement, &#x27;inactive&#x27;);
        },

        /**
         * Adds the loading icon to a contianer
         * @param $container
         */
        addLoadingIcon: function ($container) {
            this.sandbox.dom.removeClass($container, &#x27;fa-chevron-right inactive&#x27;);

            if (this.dom.$loader === null) {
                this.dom.$loader = this.sandbox.dom.createElement(&#x27;&lt;div class=&quot;&#x27;+ constants.nodeLoaderClass +&#x27;&quot;/&gt;&#x27;);
                this.sandbox.dom.hide(this.dom.$loader);
            }
            if (this.sandbox.dom.is(this.dom.$loader, &#x27;:empty&#x27;)) {
                this.sandbox.start([
                    {
                        name: &#x27;loader@husky&#x27;,
                        options: {
                            el: this.dom.$loader,
                            size: &#x27;16px&#x27;,
                            color: &#x27;#666666&#x27;
                        }
                    }
                ]);
            }
            this.sandbox.dom.detach(this.dom.$loader);
            this.sandbox.dom.html($container, this.dom.$loader);
            this.sandbox.dom.show(this.dom.$loader);
        },

        /**
         * Removes loading icon from selected element
         */
        removeLoadingIconForSelected: function () {
            if (!!this.$selectedElement) {
                var $arrow = this.sandbox.dom.find(&#x27;.arrow&#x27;, this.$selectedElement);
                this.sandbox.dom.hide(this.dom.$loader);
                this.sandbox.dom.prependClass($arrow, &#x27;fa-chevron-right&#x27;);
            }
        },

        /**
         * Stores data in internal structure - seperated by column number
         * @param {Object} item
         * @param {Number} columnNumber
         */
        storeDataItem: function (columnNumber, item) {

            if (!this.columns[columnNumber]) {
                this.columns[columnNumber] = {};
            }
            this.columns[columnNumber][item[this.options.idName]] = item;
        },

        bindDOMEvents: function () {
            this.sandbox.dom.on(this.$el, &#x27;click&#x27;, this.itemSelected.bind(this), &#x27;li:not(.selected)&#x27;);

            this.sandbox.dom.on(this.$el, &#x27;mouseenter&#x27;, this.itemMouseEnter.bind(this), &#x27;.column-navigation li&#x27;);
            this.sandbox.dom.on(this.$el, &#x27;mouseleave&#x27;, this.itemMouseLeave.bind(this), &#x27;.column-navigation li&#x27;);

            this.sandbox.dom.on(this.$el, &#x27;mouseenter&#x27;, this.showOptions.bind(this), &#x27;.column&#x27;);
            this.sandbox.dom.on(this.dom.$add, &#x27;click&#x27;, this.addNode.bind(this));
            this.sandbox.dom.on(this.$el, &#x27;click&#x27;, this.actionClickHandler.bind(this), &#x27;.action&#x27;);
            this.sandbox.dom.on(this.$el, &#x27;dblclick&#x27;, this.actionClickHandler.bind(this), &#x27;li&#x27;);

            this.sandbox.dom.on(this.$el, &#x27;click&#x27;, function (event) {
                this.sandbox.dom.stopPropagation(event);
            }.bind(this), &#x27;input[type=&quot;checkbox&quot;]&#x27;);

            if (this.options.responsive === true) {
                this.sandbox.dom.on(this.sandbox.dom.$window, &#x27;resize&#x27;, function () {
                    this.setContainerHeight();
                    this.setOverflowClass();
                }.bind(this));
            }

            if (this.options.orderable) {
                this.sandbox.dom.on(this.$el, &#x27;click&#x27;, function(event) {
                    this.sandbox.dom.stopPropagation(event);
                }.bind(this), &#x27;.&#x27; + constants.orderInputClass);

                this.sandbox.dom.on(this.$el, &#x27;focus&#x27;, function(event) {
                    if (this.isOrdering === true) {
                        this.sandbox.dom.blur(event.currentTarget);
                        return false;
                    }
                    this.sandbox.dom.select(event.currentTarget);
                }.bind(this), &#x27;.&#x27; + constants.orderInputClass + &#x27; input&#x27;);

                // save last clicked element -&gt; used to trigger the default action after the ordering has finished
                this.sandbox.dom.on(this.dom.$wrapper, &#x27;mousedown&#x27;, function(event) {
                    this.lastClicked = this.sandbox.dom.$(event.target);
                }.bind(this));

                this.sandbox.dom.on(this.dom.$ok, &#x27;click&#x27;, this.closeOrderMode.bind(this));
                this.sandbox.dom.on(this.$el, &#x27;keydown&#x27;, this.orderKeyHandler.bind(this), &#x27;.&#x27; + constants.orderInputClass + &#x27; input&#x27;);
                this.sandbox.dom.on(this.$el, &#x27;focusout&#x27;, this.orderBlurHandler.bind(this), &#x27;.&#x27; + constants.orderInputClass);
            }
        },

        /**
         * Handles the key-down event of a order-input
         * @param event
         */
        orderKeyHandler: function(event) {
            if (event.keyCode === 13) { // blur on enter
                this.sandbox.dom.blur(event.currentTarget);
            }
            if (event.keyCode === 27) { // cancel on esc
                var column = this.sandbox.dom.attr(this.sandbox.dom.parents(
                        event.currentTarget, &#x27;.&#x27; + constants.columnClass), &#x27;data-column&#x27;),
                    item = this.sandbox.dom.attr(this.sandbox.dom.parents(
                        event.currentTarget, &#x27;.&#x27; + constants.columnItemClass), &#x27;data-id&#x27;);
                this.resetOrderInput(column, item);
                this.sandbox.dom.blur(event.currentTarget);
            }
        },

        /**
         * Handles the blur event of a order-input
         * @param event
         */
        orderBlurHandler: function(event) {
            if (this.isOrdering === false) {
                var column = this.sandbox.dom.attr(this.sandbox.dom.parents(event.currentTarget, &#x27;.&#x27; + constants.columnClass), &#x27;data-column&#x27;),
                    item = this.sandbox.dom.attr(this.sandbox.dom.parents(event.currentTarget, &#x27;.&#x27; + constants.columnItemClass), &#x27;data-id&#x27;),
                    $input = this.sandbox.dom.find(&#x27;input&#x27;, this.columns[column][item].$el);
                // if is an integer
                if (this.sandbox.dom.isNumeric(this.sandbox.dom.val($input)) &amp;&amp;
                    Math.floor(this.sandbox.dom.val($input)) == this.sandbox.dom.val($input)) {
                    this.orderPrepare(column, item);
                } else {
                    this.orderError(column, item);
                }
            }
        },

        /**
         * Looks if the position changes and executes the order or resets the inputs
         * @param column - column in which the item is
         * @param item - the id of the item
         */
        orderPrepare: function(column, item) {
            var $input = this.sandbox.dom.find(&#x27;input&#x27;, this.columns[column][item].$el),
            position = this.normalizeOrderPosition(column, parseInt(this.sandbox.dom.val($input), 10));
            this.sandbox.dom.val($input, position);
            this.sandbox.dom.removeClass(this.columns[column][item].$el, constants.orderErrorClass);
            if (position !== this.columns[column][item].order) {
                this.isOrdering = true;
                this.confirmOrder(
                    function() { // ok callback
                        this.order(column, item, position);
                        this.isOrdering = false;
                        this.sandbox.dom.click(this.lastClicked);
                    }.bind(this),
                    function() { // cancel callback
                        this.resetOrderInput(column, item);
                        this.isOrdering = false;
                        this.sandbox.dom.click(this.lastClicked);
                    }.bind(this)
                );
            }
        },

        /**
         * Changes the position of an item and updates the positions of the other items in the column
         * @param column - the index of the column in which the item is
         * @param item - the id of the item
         * @param newPosition - the new position of the item
         */
        order: function(column, item, newPosition) {
            var oldPosition = this.columns[column][item].order;
            this.sandbox.util.each(this.columns[column], function (itemId) {
                this.repositionItem(column, itemId, oldPosition, newPosition);
                this.resetOrderInput(column, itemId);
            }.bind(this));
            this.updateItemDomPosition(column, item);
            this.sandbox.util.delay(this.highlight.bind(this, item), 550);
            this.sandbox.emit(ORDERED.call(this), item, newPosition);
            this.isOrdering = false;
        },

        /**
         * Determines and resets the position of a single item, given a position-change
         * @param column - the column in which the item is
         * @param item - the id of the item
         * @param oldPosition - the old position of the position-change
         * @param newPosition - the new position of the position-change
         */
        repositionItem: function(column, item, oldPosition, newPosition) {
            if (this.columns[column][item].order === oldPosition) { // update property to new position
                this.columns[column][item].order = newPosition;
            } else { // update the order-position of the other items
                if (this.columns[column][item].order &gt; oldPosition &amp;&amp;
                    this.columns[column][item].order &lt;= newPosition) {
                    this.columns[column][item].order--;
                } else if (this.columns[column][item].order &lt; oldPosition &amp;&amp;
                    this.columns[column][item].order &gt;= newPosition) {
                    this.columns[column][item].order++;
                }
            }
        },

        /**
         * Brings an item to the position set in the order-position-property
         * @param column - the column of the item
         * @param item - the id of the item
         */
        updateItemDomPosition: function(column, item) {
            var $list = this.sandbox.dom.parent(this.columns[column][item].$el);
            this.sandbox.dom.detach(this.columns[column][item].$el);
            this.sandbox.dom.insertAt(
                this.columns[column][item].order - 1, &#x27;.&#x27; + constants.columnItemClass,
                $list, this.columns[column][item].$el
            );
            this.sandbox.dom.scrollAnimate(
                this.sandbox.dom.position(this.columns[column][item].$el).top,
                this.sandbox.dom.parents(this.columns[column][item].$el, &#x27;.&#x27; + constants.columnClass)
            );
        },

        /**
         * Resets the position input of an item
         * @param column
         * @param item
         */
        resetOrderInput: function(column, item) {
            var $input = this.sandbox.dom.find(&#x27;input&#x27;, this.columns[column][item].$el);
            this.sandbox.dom.val($input, this.columns[column][item].order);
        },

        /**
         * Normalizes a position used for ordering
         * @param column - the column for which the position gets normalized
         * @param position (int) - the position to normalize
         * @returns int - the normalized position
         */
        normalizeOrderPosition: function(column, position) {
            position = (position &lt; 1) ? 1 : position;
            return (position &gt; (Object.keys(this.columns[column])).length) ?
                        Object.keys(this.columns[column]).length : position;
        },

        /**
         * Sets css-classes on an item, through which an input error get signalized
         * @param column - the column in which the item is
         * @param item - the id of the item
         */
        orderError: function(column, item) {
            this.sandbox.dom.addClass(this.columns[column][item].$el, constants.orderErrorClass);
        },

        /**
         * Shows a confirmation-overlay
         * @param okCallback - callback to execute if clicked on ok
         * @param closeCallback - callback to execute if clicked on ok
         */
        confirmOrder: function(okCallback, closeCallback) {
            this.sandbox.confirm.warning(this,
                this.options.orderConfirmTitle, this.options.orderConfirmMessage,
                okCallback, closeCallback);
        },

        /**
         * Sets an overflow-class to the container if the navigation is scrollable
         */
        setOverflowClass: function () {
            var $navigation = this.sandbox.dom.find(&#x27;.column-navigation&#x27;, this.$el);
            if (this.sandbox.dom.width($navigation) &lt; this.sandbox.dom.get($navigation, 0).scrollWidth) {
                this.sandbox.dom.addClass($navigation, &#x27;overflow&#x27;);
            } else {
                this.sandbox.dom.removeClass($navigation, &#x27;overflow&#x27;);
            }
        },

        bindCustomEvents: function () {
            this.sandbox.on(BREADCRUMB.call(this), this.getBreadCrumb.bind(this));
            this.sandbox.on(UNMARK.call(this), this.unmark.bind(this));
            this.sandbox.on(HIGHLIGHT.call(this), this.highlight.bind(this));
            this.sandbox.on(ORDER.call(this), this.startOrderModeItem.bind(this));

            this.sandbox.on(&#x27;husky.dropdown.&#x27; + this.options.instanceName + &#x27;.settings.dropdown.item.click&#x27;, this.dropdownItemClicked.bind(this));

            if (this.options.responsive === true) {
                this.sandbox.on(RESIZE.call(this), function () {
                    this.setContainerHeight();
                    this.setOverflowClass();
                }.bind(this));
            }
        },

        /**
         * Sets a column containing an item with a given id in order-mode
         * @param itemId - the id of the item
         */
        startOrderModeItem: function(itemId) {
            var column = this.getColumnForItem(itemId);
            if (column &gt; 0) {
                this.startOrderModeColumn(column);
            }
        },


        /**
         * Sets a column in order-mode
         * @param column - the index of the column
         */
        startOrderModeColumn: function(column) {
            if (this.inOrderMode === false &amp;&amp; Object.keys(this.columns[column]).length &gt; 1) {
                this.inOrderMode = true;
                var $column = this.$find(&#x27;.&#x27; + constants.columnClass + &#x27;[data-column=&quot;&#x27; + column + &#x27;&quot;]&#x27;);
                this.lockOptions(column);
                this.sandbox.dom.addClass($column, constants.orderModeClass);
                this.sandbox.dom.hide(this.dom.$settings);
                this.sandbox.dom.hide(this.dom.$add);
                this.sandbox.dom.show(this.dom.$ok);
                this.setColumnTextWidth(column);
                this.sandbox.emit(ORDER_START.call(this));
            }
        },

        /**
         * Closes the order mode
         */
        closeOrderMode: function() {
            if (this.inOrderMode === true) {
                var $column = this.$find(&#x27;.&#x27; + constants.columnClass + &#x27;.&#x27; + constants.orderModeClass),
                    column = this.sandbox.dom.data($column, &#x27;column&#x27;);
                this.unlockOptions();
                this.sandbox.dom.removeClass($column, constants.orderModeClass);
                this.sandbox.dom.hide(this.dom.$ok);
                this.sandbox.dom.show(this.dom.$settings);
                this.sandbox.dom.show(this.dom.$add);
                this.setColumnTextWidth(column);
                this.inOrderMode = false;
                this.sandbox.emit(ORDER_END.call(this));
            }
        },

        /**
         * Highlights an item
         * @param item - the id of the item
         */
        highlight: function(item) {
            var column = this.getColumnForItem(item);
            if (column &gt;= 0) {
                this.sandbox.dom.addClass(this.columns[column][item].$el, constants.highlightClass);

                // remove class after effect has finished
                this.sandbox.dom.on(this.columns[column][item].$el,&#x27;animationend webkitAnimationEnd oanimationend MSAnimationEnd&#x27;, function() {
                    this.sandbox.dom.removeClass(this.columns[column][item].$el, constants.highlightClass);
                }.bind(this));
            }
        },

        /**
         * Gets execute after an item in the settings-dropdown has been clicked
         * @param dropdownItem - the dropdown-item
         */
        dropdownItemClicked: function (dropdownItem) {
            if (!!this.lastHoveredColumn &amp;&amp; !!dropdownItem.mode &amp;&amp; dropdownItem.mode === &#x27;order&#x27;) {
                this.startOrderModeColumn(this.lastHoveredColumn);
            }
            if (!!this.selected[this.lastHoveredColumn]) {
                if (!!dropdownItem.callback) {
                    dropdownItem.callback(dropdownItem, this.selected[this.lastHoveredColumn], this.columns[this.lastHoveredColumn]);
                } else {
                    this.sandbox.emit(SETTINGS.call(this), dropdownItem, this.selected[this.lastHoveredColumn], this.columns[this.lastHoveredColumn]);
                }
            }
        },

        /**
         * Unmarks a node for a given id
         * @param id {Number|String} the id of the node to unmark
         */
        unmark: function (id) {
            var $element = this.$find(&#x27;li[data-id=&quot;&#x27; + id + &#x27;&quot;]&#x27;);
            if (!!$element.length) {
                this.sandbox.dom.removeClass($element, constants.markedClass);
                this.marked.splice(this.marked.indexOf(id), 1);
            }
        },

        /**
         * Sets the text width
         * @param {Object} event
         */
        itemMouseEnter: function (event) {
            this.setItemsTextWidth(event.currentTarget);
        },

        /**
         * Sets the text width
         * @param {Object} event
         */
        itemMouseLeave: function (event) {
            this.setItemsTextWidth(event.currentTarget);
        },

        /**
         * Returns the breadcrumb
         * @param {Function} callback
         */
        getBreadCrumb: function (callback) {
            if (typeof callback === &#x27;function&#x27;) {
                callback(this.selected);
            } else {
                this.sandbox.logger.log(&quot;callback is not a function&quot;);
            }
        },

        /**
         * Shows the options at the last available column
         */
        showOptionsAtLast: function () {
            var $lastColumn = this.sandbox.dom.last(this.sandbox.dom.find(&#x27;.column&#x27;, this.dom.$container));
            this.showOptions({
                currentTarget: $lastColumn
            });
        },

        /**
         * Shows the options below the last hovered column
         * @param {Object} event
         */
        showOptions: function (event) {
            if (this.optionsLocked === false) {
                var $currentTarget = this.sandbox.dom.$(event.currentTarget);

                this.displayOptions($currentTarget);

                this.sandbox.dom.off(this.dom.$container, &#x27;scroll.column-navigation.&#x27; + this.options.instanceName);
                this.sandbox.dom.on(this.dom.$container, &#x27;scroll.column-navigation.&#x27; + this.options.instanceName, this.displayOptions.bind(this, $currentTarget));
            }
        },

        /**
         * Shows the options below the passed column and locks them
         * @param column - the index of the column
         */
        lockOptions: function(column) {
            var $column = this.$find(&#x27;.&#x27;+ constants.columnClass +&#x27;[data-column=&quot;&#x27; + column + &#x27;&quot;]&#x27;);
            if (!!$column.length) {
                this.showOptions({currentTarget: $column});
                this.optionsLocked = true;
            }
        },

        /**
         * Unlocks the options
         */
        unlockOptions: function() {
            this.optionsLocked = false;
        },

        /**
         * Displays the options-navigation under a given column
         * @param $activeColumn {object} column for which the options will be inserted
         */
        displayOptions: function ($activeColumn) {
            var visibleRatio;

            this.lastHoveredColumn = this.sandbox.dom.data($activeColumn, &#x27;column&#x27;);

            // calculate the ratio of how much of the hovered column is visible
            if (this.sandbox.dom.position($activeColumn).left + this.sandbox.dom.width($activeColumn) &gt; this.sandbox.dom.width(this.dom.$container)) {
                visibleRatio = (this.sandbox.dom.width(this.dom.$container) - this.sandbox.dom.position($activeColumn).left ) / this.sandbox.dom.width($activeColumn);
            } else {
                visibleRatio = (this.sandbox.dom.width($activeColumn) + this.sandbox.dom.position($activeColumn).left) / this.sandbox.dom.width($activeColumn);
            }

            // display the option only if the column is visible enough
            if (visibleRatio &gt;= constants.minVisibleRatio) {
                this.sandbox.dom.css(this.$optionsContainer, {&#x27;visibility&#x27;: &#x27;visible&#x27;});
                this.updateOptionsMargin($activeColumn);
            } else {
                this.hideOptions();
            }
        },

        /**
         * Updates the position of the options
         * @param $activeColumn {object} dom-object of active column
         */
        updateOptionsMargin: function ($activeColumn) {
            var marginLeft = this.sandbox.dom.position($activeColumn).left - 1;
            this.sandbox.dom.css(this.$optionsContainer, &#x27;margin-left&#x27;, marginLeft + &#x27;px&#x27;);
        },

        /**
         * Hides options
         */
        hideOptions: function () {
            this.sandbox.dom.css(this.$optionsContainer, {&#x27;visibility&#x27;: &#x27;hidden&#x27;});
        },

        /**
         * Item was selected and data will be loaded if has sub
         * @param {Object} event
         */
        itemSelected: function (event) {
            //only do something if no column is loading
            if (this.columnLoadStarted === false) {
                this.closeOrderMode(); // force closing of possible order mode
                this.$selectedElement = this.sandbox.dom.$(event.currentTarget);
                var id = this.sandbox.dom.data(this.$selectedElement, &#x27;id&#x27;),
                    column = this.sandbox.dom.data(this.sandbox.dom.parent(this.sandbox.dom.parent(this.$selectedElement)), &#x27;column&#x27;),
                    selectedItem = this.columns[column][id],
                    length = this.selected.length - 1,
                    i, $arrowElement;


                if (this.sandbox.dom.hasClass(this.$selectedElement, &#x27;selected&#x27;)) { // is element already selected

                    this.sandbox.emit(SELECTED.call(this), selectedItem);

                } else { // element not selected

                    this.removeCurrentSelected(column);

                    this.sandbox.dom.addClass(this.$selectedElement, &#x27;selected&#x27;);
                    $arrowElement = this.sandbox.dom.find(&#x27;.arrow&#x27;, this.$selectedElement);
                    this.addLoadingIcon($arrowElement);

                    if (!!selectedItem) {

                        // remove old elements from breadcrumb
                        for (i = length; i &gt;= column; i--) {
                            delete this.selected[i];
                        }

                        // add element to breadcrumb
                        this.selected[column] = selectedItem;
                        this.sandbox.emit(SELECTED.call(this), selectedItem);

                        if (!!selectedItem[this.options.hasSubName]) {
                            this.load(selectedItem._links.children, column);
                        }

                        this.removeColumns(column + 1);
                        this.setOverflowClass();
                    }
                }

                // scroll for add column
                if (!selectedItem.hasSub) {
                    this.insertAddColumn(selectedItem, column);
                    this.scrollIfNeeded(column);
                    this.setOverflowClass();
                }
            }
        },

        insertAddColumn: function (selectedItem, column) {
            var $addColumn = this.sandbox.dom.createElement(this.sandbox.util.template(templates.column)({
                columnNumber: column + 1,
                id: &#x27;column&#x27; + this.options.instanceName + &#x27;-&#x27; + (column + 1)
            }));
            // fill it with the &quot;No Page&quot;-content
            this.sandbox.dom.append($addColumn, this.sandbox.dom.createElement(
                this.sandbox.util.template(templates.noPage)({
                    description: this.sandbox.translate(this.options.noPageDescription)
                })
            ));
            this.sandbox.dom.append(this.dom.$container, $addColumn);
            this.filledColumns++;
        },

        /**
         * Scrolls if needed
         * @param column
         */
        scrollIfNeeded: function (column) {
            if (column &gt; constants.displayedcolumns) {
                this.sandbox.dom.scrollLeft(this.dom.$container, (column - constants.displayedcolumns) * constants.columnWidth);
            }
        },

        /**
         * Removes the selected class from old elements
         * @param {Number} column
         */
        removeCurrentSelected: function (column) {
            var $items = this.sandbox.dom.find(&#x27;li&#x27;, &#x27;#column&#x27; + this.options.instanceName + &#x27;-&#x27; + column);

            this.sandbox.util.each($items, function (index, $el) {
                this.sandbox.dom.removeClass($el, &#x27;selected&#x27;);
                var $arrowElement = this.sandbox.dom.find(&#x27;.arrow&#x27;, $el);
                this.sandbox.dom.addClass($arrowElement, &#x27;inactive&#x27;);
            }.bind(this));
        },

        /**
         * Emits an add event
         */
        addNode: function () {
            var parent = this.selected[this.lastHoveredColumn - 1] || null;
            this.sandbox.emit(ADD.call(this), parent);
        },

        /**
         * Handles the click on action-icons as well as the double click on items
         * @param {Object} event
         */
        actionClickHandler: function (event) {
            var $listItem, id, item, column;

            if (this.sandbox.dom.hasClass(event.currentTarget, &#x27;action&#x27;) === true) {
                $listItem = this.sandbox.dom.parent(this.sandbox.dom.parent(event.currentTarget));
            } else {
                $listItem = this.sandbox.dom.$(event.currentTarget);
            }
            column = this.sandbox.dom.index(this.sandbox.dom.parents(event.currentTarget, &#x27;.column&#x27;));
            id = this.sandbox.dom.attr($listItem, &#x27;data-id&#x27;);
            item = this.columns[column][id];

            if (this.options.markable === true) {
                this.sandbox.dom.addClass($listItem, constants.markedClass);
                this.marked.push(id);
                this.setItemsTextWidth($listItem);
            }

            this.sandbox.dom.stopPropagation(event);
            this.sandbox.emit(ACTION.call(this), item);
        }
    };
});


    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
